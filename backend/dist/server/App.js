"use strict";var q=Object.create;var m=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var w=(t,r)=>{for(var n in r)m(t,n,{get:r[n],enumerable:!0})},x=(t,r,n,c)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of b(r))!j.call(t,a)&&a!==n&&m(t,a,{get:()=>r[a],enumerable:!(c=h(r,a))||c.enumerable});return t};var y=(t,r,n)=>(n=t!=null?q(T(t)):{},x(r||!t||!t.__esModule?m(n,"default",{value:t,enumerable:!0}):n,t)),S=t=>x(m({},"__esModule",{value:!0}),t);var A={};w(A,{App:()=>v});module.exports=S(A);var l=y(require("express")),p=y(require("body-parser")),f=y(require("cors")),d=y(require("knex")),i=require("./abstruction"),v;(c=>{class t{static run(){var e=(0,l.default)();e.set("view engine","ejs"),e.set("views","./views"),e.use(p.default.urlencoded({extended:!0})),e.use(p.default.json()),e.use((0,f.default)()),e.get("/",(s,u)=>{u.send("test noor project worked!...")}),e.use("/api",r),e.listen(3e3)}}c.main=t;var r=l.default.Router({mergeParams:!0});r.get("/page/:num",(a,e)=>{n.getText({pageNo:a.params.num},n.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})}),r.get("/search",(a,e)=>{if(!a.query.s)return e.status(404).send("keyword not found!"),0;n.search(a.query.s?.toString(),n.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})}),r.get("/sura",(a,e)=>{var s=a.query.s?.toString()||"1",u=a.query.a?.toString()||"1",o=a.query.a?{"quran_text.sura":a.query.s?.toString()||"1","quran_text.aya":a.query.a?.toString()}:{"quran_text.sura":a.query.s?.toString()||"1"};n.getText(o,n.meaningful(a.query.m?.toString())).then(g=>{e.json(g)})}),r.get("/joz/:j",(a,e)=>{n.getText({joz:a.params.j?.toString()},n.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})});class n{static connect(){var e="./database/quran1.db",s=(0,d.default)({client:"sqlite3",connection:{filename:e},useNullAsDefault:!0});return s}static async search(e,s){var u=this.connect(),o=e.replaceAll("\u06A9","\u0643").replaceAll("\u06CC","\u064A"),g=u("quran_text").where("text_clean","like",`%${o}%`),k=await this.getMeaning(s,g);return k}static async getText(e,s){var u=this.connect(),o=u("quran_text").where(e),g=await this.getMeaning(s,o);return g}static async getMeaning(e,s){var u=await s.join(e,o=>{o.on(`${e}.sura`,"=","quran_text.sura").andOn(`${e}.aya`,"=","quran_text.aya")});return u}static meaningful(e="ansarian"){switch(e){case"shakir":return i.Types.meaningful.shakir;case"ansarian":return i.Types.meaningful.ansarian;case"fooladvand":return i.Types.meaningful.fooladvand;case"ghomshei":return i.Types.meaningful.ghomshei;case"makarem":return i.Types.meaningful.makarem;case"qaraati":return i.Types.meaningful.qaraati;default:return i.Types.meaningful.ansarian}}}c.Data=n})(v||={});0&&(module.exports={App});
