"use strict";var k=Object.create;var g=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var w=(n,r)=>{for(var t in r)g(n,t,{get:r[t],enumerable:!0})},x=(n,r,t,p)=>{if(r&&typeof r=="object"||typeof r=="function")for(let a of b(r))!j.call(n,a)&&a!==t&&g(n,a,{get:()=>r[a],enumerable:!(p=q(r,a))||p.enumerable});return n};var y=(n,r,t)=>(t=n!=null?k(T(n)):{},x(r||!n||!n.__esModule?g(t,"default",{value:n,enumerable:!0}):t,n)),S=n=>x(g({},"__esModule",{value:!0}),n);var A={};w(A,{App:()=>v});module.exports=S(A);var c=y(require("express")),l=y(require("body-parser")),f=y(require("cors")),d=y(require("knex")),u=require("./abstruction"),v;(p=>{class n{static run(){var e=(0,c.default)();e.set("view engine","ejs"),e.set("views","./views"),e.use(l.default.urlencoded({extended:!0})),e.use(l.default.json()),e.use((0,f.default)()),e.get("/",(s,i)=>{i.send("test noor project worked!...")}),e.use("/api",r),e.listen(3e3)}}p.main=n;var r=c.default.Router({mergeParams:!0});r.get("/page/:num",(a,e)=>{t.getText({pageNo:a.params.num},t.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})}),r.get("/search",(a,e)=>{if(!a.query.s)return e.status(404).send("keyword not found!"),0;t.search(a.query.s?.toString(),t.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})}),r.get("/sura",(a,e)=>{var s=a.query.s?.toString()||"1",i=a.query.a?.toString()||"1",o=a.query.a?{"quran_text.sura":a.query.s?.toString()||"1","quran_text.aya":a.query.a?.toString()}:{"quran_text.sura":a.query.s?.toString()||"1"};t.getText(o,t.meaningful(a.query.m?.toString())).then(m=>{e.json(m)})}),r.get("/joz/:j",(a,e)=>{t.getText({joz:a.params.j?.toString()},t.meaningful(a.query.m?.toString())).then(s=>{e.json(s)})});class t{static database="./database/quran1.db";static connect(){var e=(0,d.default)({client:"sqlite3",connection:{filename:this.database},useNullAsDefault:!0});return e}static async search(e,s){var i=this.connect(),o=e.replaceAll("\u06A9","\u0643").replaceAll("\u06CC","\u064A"),m=i("quran_text").where("text_clean","like",`%${o}%`),h=await this.getMeaning(s,m);return h}static async getText(e,s){var i=this.connect(),o=i("quran_text").where(e),m=await this.getMeaning(s,o);return m}static async getMeaning(e,s){var i=await s.join(e,o=>{o.on(`${e}.sura`,"=","quran_text.sura").andOn(`${e}.aya`,"=","quran_text.aya")});return i}static meaningful(e="ansarian"){switch(e){case"shakir":return u.Types.meaningful.shakir;case"ansarian":return u.Types.meaningful.ansarian;case"fooladvand":return u.Types.meaningful.fooladvand;case"ghomshei":return u.Types.meaningful.ghomshei;case"makarem":return u.Types.meaningful.makarem;case"qaraati":return u.Types.meaningful.qaraati;default:return u.Types.meaningful.ansarian}}}p.Data=t})(v||={});0&&(module.exports={App});
