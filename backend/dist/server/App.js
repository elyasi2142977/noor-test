"use strict";var h=Object.create;var g=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var T=Object.getOwnPropertyNames;var b=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var S=(s,t)=>{for(var n in t)g(s,n,{get:t[n],enumerable:!0})},l=(s,t,n,y)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of T(t))!j.call(s,a)&&a!==n&&g(s,a,{get:()=>t[a],enumerable:!(y=k(t,a))||y.enumerable});return s};var m=(s,t,n)=>(n=s!=null?h(b(s)):{},l(t||!s||!s.__esModule?g(n,"default",{value:s,enumerable:!0}):n,s)),R=s=>l(g({},"__esModule",{value:!0}),s);var w={};S(w,{App:()=>v});module.exports=R(w);var p=m(require("express")),x=m(require("body-parser")),q=m(require("cors")),f=m(require("knex")),o=require("./abstruction"),v;(y=>{class s{static run(){var e=(0,p.default)();e.set("view engine","ejs"),e.set("views","./views"),e.use(x.default.urlencoded({extended:!0})),e.use(x.default.json()),e.use((0,q.default)()),e.get("/",(r,i)=>{i.send("test noor project worked!...")}),e.use("/api",t),e.listen(3e3)}}y.main=s;var t=p.default.Router({mergeParams:!0});t.get("/page/:num",(a,e)=>{n.getText({pageNo:a.params.num},n.meaningful(a.query.m?.toString())).then(r=>{e.json(r)})}),t.get("/search",(a,e)=>{if(!a.query.s)return e.status(404).send("keyword not found!"),0;n.search(a.query.s?.toString(),n.meaningful(a.query.m?.toString())).then(r=>{e.json(r)})}),t.get("/sura",(a,e)=>{var r=a.query.s?.toString()||"1",i=a.query.a?.toString()||"1",u=a.query.a?{"quran_text.sura":a.query.s?.toString()||"1","quran_text.aya":a.query.a?.toString()}:{"quran_text.sura":a.query.s?.toString()||"1"};n.getText(u,n.meaningful(a.query.m?.toString())).then(c=>{e.json(c)})}),t.get("/joz/:j",(a,e)=>{n.getText({joz:a.params.j?.toString()},n.meaningful(a.query.m?.toString())).then(r=>{e.json(r)})}),t.get("/jozlist",(a,e)=>{n.getJoz().then(r=>{e.json(r)})}),t.get("/suralist",(a,e)=>{n.getSura().then(r=>{e.json(r)})});class n{static connect(){var e="./database/quran1.db",r=(0,f.default)({client:"sqlite3",connection:{filename:e},useNullAsDefault:!0});return r}static async search(e,r){var i=this.connect(),u=e.replaceAll("\u06A9","\u0643").replaceAll("\u06CC","\u064A"),c=i("quran_text").where("text_clean","like",`%${u}%`),d=await this.getMeaning(r,c);return d}static async getText(e,r){var i=this.connect(),u=i("quran_text").where(e),c=await this.getMeaning(r,u);return c}static async getMeaning(e,r){var i=await r.join(e,u=>{u.on(`${e}.sura`,"=","quran_text.sura").andOn(`${e}.aya`,"=","quran_text.aya")}).join("quranNameList",u=>{u.on("quran_text.sura","=","quranNameList.id")});return i}static async getJoz(){var e=this.connect(),r=await e("quranJOZ");return r}static async getSura(){var e=this.connect(),r=await e("quranNameList");return r}static meaningful(e="ansarian"){switch(e){case"shakir":return o.Types.meaningful.shakir;case"ansarian":return o.Types.meaningful.ansarian;case"fooladvand":return o.Types.meaningful.fooladvand;case"ghomshei":return o.Types.meaningful.ghomshei;case"makarem":return o.Types.meaningful.makarem;case"qaraati":return o.Types.meaningful.qaraati;default:return o.Types.meaningful.ansarian}}}y.Data=n})(v||={});0&&(module.exports={App});
