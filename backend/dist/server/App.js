"use strict";var d=Object.create;var c=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var b=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var R=(s,n)=>{for(var r in n)c(s,r,{get:n[r],enumerable:!0})},x=(s,n,r,g)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of b(n))!T.call(s,a)&&a!==r&&c(s,a,{get:()=>n[a],enumerable:!(g=k(n,a))||g.enumerable});return s};var l=(s,n,r)=>(r=s!=null?d(j(s)):{},x(n||!s||!s.__esModule?c(r,"default",{value:s,enumerable:!0}):r,s)),w=s=>x(c({},"__esModule",{value:!0}),s);var I={};R(I,{App:()=>f});module.exports=w(I);var y=l(require("express")),m=l(require("body-parser")),q=l(require("cors")),h=l(require("knex")),o=require("./abstraction"),f;(g=>{class s{static run(){var e=(0,y.default)();e.set("view engine","ejs"),e.set("views","./views"),e.use(m.default.urlencoded({extended:!0})),e.use(m.default.json()),e.use((0,q.default)()),e.get("/",(t,i)=>{i.send("test noor project worked!...")}),e.use("/api",n),e.listen(3e3)}}g.main=s;var n=y.default.Router({mergeParams:!0});n.get("/page/:num",(a,e)=>{r.getText({pageNo:a.params.num},a.query.m?.toString()).then(t=>{if(t.length===0)return console.log(t),e.status(404).json([{text:"\u0635\u0641\u062D\u0647 \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u0648\u062C\u0648\u062F \u0646\u062F\u0627\u0631\u062F!..."}]),0;console.log(t),e.json(t)})}),n.get("/search",(a,e)=>{if(!a.query.s)return e.status(404).send("keyword not found!"),0;r.search(a.query.s?.toString(),a.query.m?.toString()).then(t=>{if(t.length===0)return console.log(t),e.status(404).json([{text:"\u0645\u0648\u0631\u062F\u06CC \u062F\u0631 \u0645\u062A\u0646 \u0642\u0631\u0622\u0646 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F!..."}]),0;console.log(t),e.json(t)})}),n.get("/sura",(a,e)=>{var t=a.query.a!="0"?{"quran_text.sura":a.query.s?.toString()||"1","quran_text.aya":a.query.a?.toString()}:{"quran_text.sura":a.query.s?.toString()||"1"};r.getText(t,a.query.m?.toString()).then(i=>{if(i.length===0)return console.log(i),e.status(404).json([{text:"\u0622\u06CC\u0627\u062A \u0645\u0648\u0631\u062F \u0646\u0638\u0631 \u06CC\u0627\u0641\u062A \u0646\u0634\u062F!..."}]),0;console.log(i),e.json(i)})}),n.get("/joz/:j",(a,e)=>{r.getText({joz:a.params.j?.toString()},a.query.m?.toString()).then(t=>{if(t.length===0)return console.log(t),e.status(404).json([{err:"array empty"}]),0;console.log(t),e.json(t)})}),n.get("/jozlist",(a,e)=>{r.getJoz().then(t=>{e.json(t)})}),n.get("/suralist",(a,e)=>{r.getSura().then(t=>{e.json(t)})}),n.get("/translist",(a,e)=>{r.getMeaningfuls().then(t=>{e.json(t)})});class r{static connect(){var e="./database/quran1.db",t=(0,h.default)({client:"sqlite3",connection:{filename:e},useNullAsDefault:!0});return t}static async search(e,t="fa_ansarian"){var i=this.connect(),u=e.replaceAll("\u06A9","\u0643").replaceAll("\u06CC","\u064A"),p=i("quran_text").where("text_clean","like",`%${u}%`),v=await this.getMeaning(t,p);return v}static async getText(e,t="fa_ansarian"){var i=this.connect(),u=i("quran_text").where(e),p=await this.getMeaning(t,u);return p}static async getMeaning(e,t){var i=await t.join(e,u=>{u.on(`${e}.sura`,"=","quran_text.sura").andOn(`${e}.aya`,"=","quran_text.aya")}).join("quranNameList",u=>{u.on("quran_text.sura","=","quranNameList.id")});return i}static async getJoz(){var e=this.connect(),t=await e("quranJOZ");return t}static async getSura(){var e=this.connect(),t=await e("quranNameList");return t}static async getMeaningfuls(){var e=this.connect(),t=await e("tbl_trans");return t}static meaningful(e="ansarian"){switch(e){case"shakir":return o.Types.meaningful.shakir;case"ansarian":return o.Types.meaningful.ansarian;case"fooladvand":return o.Types.meaningful.fooladvand;case"ghomshei":return o.Types.meaningful.ghomshei;case"makarem":return o.Types.meaningful.makarem;case"qaraati":return o.Types.meaningful.qaraati;default:return o.Types.meaningful.ansarian}}}g.Data=r})(f||={});0&&(module.exports={App});
